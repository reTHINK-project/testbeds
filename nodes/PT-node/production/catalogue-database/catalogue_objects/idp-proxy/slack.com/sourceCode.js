!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define("activate",[],n):"object"==typeof exports?exports.activate=n():e.activate=n()}(this,function(){return function(e){function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}var t={};return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},n.p="",n(n.s=0)}([function(e,n,t){"use strict";function o(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function r(e,n){n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t="[\\#&?]"+n+"=([^&#]*)",o=RegExp(t),r=o.exec(e);return null===r?"":r[1]}function i(e,n){var t=new XMLHttpRequest;return"withCredentials"in t?t.open(e,n,!0):"undefined"!=typeof XDomainRequest?(t=new XDomainRequest,t.open(e,n)):t=null,new Promise(function(e,n){t?(t.onreadystatechange=function(o){if(4===t.readyState)if(200===t.status){var r=JSON.parse(t.responseText);e(r)}else n(400===t.status?"There was an error processing the token":"something else other than 200 was returned")},t.send()):n("CORS not supported")})}function s(e,n,t){return{name:"SlackProxyStub",instance:new d(e,n,t)}}Object.defineProperty(n,"__esModule",{value:!0});var c=function(){function e(e,n){for(var t=0;n.length>t;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();n.default=s;var a={clientID:"11533603872.72434934356",clientSecret:"d427ef3c957d68a292dc7c4e20b78330",redirectURI:location.origin,codeEndpoint:"https://slack.com/oauth/authorize?",tokenEndpoint:"https://slack.com/api/oauth.access?",infoEndpoint:"https://slack.com/api/users.info?",scope:"client"},u=function(e){var n=a,t=n.tokenEndpoint+"client_id="+n.clientID+"&client_secret="+n.clientSecret+"&code="+e+"&redirect_uri="+n.redirectURI;return console.log("URL",t),new Promise(function(e,n){i("GET",t).then(function(n){e(n)},function(e){n(e)})})},l={validateAssertion:function(e,n){return new Promise(function(t,o){console.log("assertion - >",e),console.log("origin - >",n),console.log("MYPROXY - VALIDATING"),t({identity:"identity@idp.com",contents:"content"})})},generateAssertion:function(e,n,t){return console.log("contents->",e),console.log("origin->",n),console.log("hint->",t),new Promise(function(e,n){var o=a;if(t){var s=r(t,"code");console.log("code",s),u(s).then(function(n){console.log("value AFTER exchangeCode",n),i("GET",o.infoEndpoint+"token="+n.access_token+"&user="+n.user_id).then(function(t){console.log("info->",t);var o=t.user.profile,r={picture:o.image_original,email:o.email,family_name:o.last_name,given_name:o.first_name,id:t.user.id},i=btoa(JSON.stringify({tokenID:n.access_token,email:o.email,id:t.user.id})),s={assertion:i,idp:{domain:"slack.com",protocol:"OAuth 2.0"},infoToken:r,interworking:{access_token:n.access_token,domain:"slack.com"},info:{expires:31536e5}};console.log("RESOLVING THIS OBJECT",s),e(s)},function(e){console.log("error->",e)})})}else{var c=o.codeEndpoint+"client_id="+o.clientID+"&scope="+o.scope+"&redirect_uri="+o.redirectURI;console.log("first url ",c,"done"),n({name:"IdPLoginError",loginUrl:c})}})}},d=function(){function e(n,t,r){o(this,e);var i=this;i.runtimeProtoStubURL=n,i.messageBus=t,i.config=r,i.messageBus.addListener("*",function(e){"domain-idp://slack.com"===e.to&&i.requestToIdp(e)}),i._sendStatus("created")}return c(e,[{key:"requestToIdp",value:function(e){var n=this,t=e.body.params;switch(e.body.method){case"generateAssertion":l.generateAssertion(t.contents,t.origin,t.usernameHint).then(function(t){n.replyMessage(e,t)},function(t){n.replyMessage(e,t)});break;case"validateAssertion":l.validateAssertion(t.assertion,t.origin).then(function(t){n.replyMessage(e,t)},function(t){n.replyMessage(e,t)})}}},{key:"replyMessage",value:function(e,n){this.messageBus.postMessage({id:e.id,type:"response",to:e.from,from:e.to,body:{code:200,value:n}})}},{key:"_sendStatus",value:function(e,n){var t=this;console.log("[Slack Idp Proxy status changed] to ",e),t._state=e;var o={type:"update",from:t.runtimeProtoStubURL,to:t.runtimeProtoStubURL+"/status",body:{value:e}};n&&(o.body.desc=n),t.messageBus.postMessage(o)}}]),e}()}]).default});