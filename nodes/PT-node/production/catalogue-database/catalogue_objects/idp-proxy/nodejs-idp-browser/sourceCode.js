!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("activate",[],t):"object"==typeof exports?exports.activate=t():e.activate=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();t.default=function(e,t,n){return{name:"NodejsProxyStub",instance:new i(e,t,n)}};var r=function(e,t){return console.log("validateAssertionProxyNODEJSFAKEBrowser:assertion",e),new Promise(function(t,n){var o=atob(e),r=JSON.parse(o).tokenID.split("."),s=JSON.parse(atob(r[1]));t({identity:s.email,contents:s.nonce})})},s=function(e,t,n){return console.log("[IDPROXY.generateAssertionFAKE_BROWSER:contents]",e),console.log("[IDPROXY.generateAssertionFAKE_BROWSER:origin]",t),console.log("[IDPROXY.generateAssertionFAKE_BROWSER:hint]",n),new Promise(function(e,t){return console.log("generateMessageResponse:"),e(generateMessageResponse)})},i=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),console.log("FAKE NODEJS constructor");var r=this;r.runtimeProtoStubURL=t,r.messageBus=n,r.config=o,r.messageBus.addListener("*",function(e){"domain-idp://nodejs-idp"===e.to&&r.requestToIdp(e)}),r._sendStatus("created")}return o(e,[{key:"requestToIdp",value:function(e){var t=this,n=e.body.params;switch(e.body.method){case"generateAssertion":s(n.contents,n.origin,n.usernameHint).then(function(n){t.replyMessage(e,n)},function(n){t.replyMessage(e,n)});break;case"validateAssertion":r(n.assertion,n.origin).then(function(n){t.replyMessage(e,n)},function(n){t.replyMessage(e,n)})}}},{key:"replyMessage",value:function(e,t){var n={id:e.id,type:"response",to:e.from,from:e.to,body:{code:200,value:t}};this.messageBus.postMessage(n)}},{key:"_sendStatus",value:function(e,t){console.log("[NodeJS.sendStatus] ",e),this._state=e;var n={type:"update",from:this.runtimeProtoStubURL,to:this.runtimeProtoStubURL+"/status",body:{value:e}};t&&(n.body.desc=t),this.messageBus.postMessage(n)}}]),e}()}]).default});