!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("activate",[],t):"object"==typeof exports?exports.activate=t():e.activate=t()}(this,function(){return function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t,n){return{name:"IMSIWProxyStub",instance:new a(e,t,n)}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;t.length>n;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();t.default=r;var s="rethink-project.eu",a=function(){function e(t,n,r){var i=this;o(this,e),this.runtimeProtoStubURL=t,this.messageBus=n,this.config=r,this.messageBus.addListener("*",function(e){e.to==="domain-idp://"+s&&i.requestToIdp(e)}),this._sendStatus("created")}return i(e,[{key:"_sendStatus",value:function(e,t){var n=this;console.log("[Slack Idp Proxy status changed] to ",e),n._state=e;var o={type:"update",from:n.runtimeProtoStubURL,to:n.runtimeProtoStubURL+"/status",body:{value:e}};t&&(o.body.desc=t),n.messageBus.postMessage(o)}},{key:"requestToIdp",value:function(e){var t=this,n=e.body.params;switch(e.body.method){case"generateAssertion":this.generateAssertion(n.contents,n.origin,n.usernameHint).then(function(n){return t.replyMessage(e,n)}).catch(function(n){return t.replyMessage(e,n)});break;case"validateAssertion":this.replyMessage(e,{identity:"identity@idp.com",contents:"content"})}}},{key:"generateAssertion",value:function(e,t,n){var o=this;return console.log("contents->",e),console.log("origin->",t),console.log("hint->",n),new Promise(function(e,t){if(n){var r=o._urlParser(n,"access_token"),i=Math.floor(Date.now()/1e3)+o._urlParser(n,"expires_in");fetch("https://www.googleapis.com/oauth2/v1/userinfo?access_token="+r).then(function(e){return e.json()}).then(function(t){var n={picture:t.picture,email:t.email,family_name:t.family_name,given_name:t.given_name},o=btoa(JSON.stringify({tokenID:r,email:t.email,id:t.id})),a={info:{expires:i},assertion:o,idp:{domain:s,protocol:"OAuth 2.0"},infoToken:n,interworking:{access_token:r,domain:s}};console.log("RESOLVING THIS OBJECT",a),e(a)}).catch(t)}else{var a="https://accounts.google.com/o/oauth2/v2/auth?scope=email%20profile&state=%2Fprofile&redirect_uri="+location.protocol+"//"+location.hostname+"&response_type=token&client_id=808329566012-tqr8qoh111942gd2kg007t0s8f277roi.apps.googleusercontent.com";console.log("first url ",a,"done"),t({name:"IdPLoginError",loginUrl:a})}})}},{key:"_urlParser",value:function(e,t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n="[\\#&?]"+t+"=([^&#]*)",o=RegExp(n),r=o.exec(e);return null===r?"":r[1]}},{key:"replyMessage",value:function(e,t){this.messageBus.postMessage({id:e.id,type:"response",to:e.from,from:e.to,body:{code:200,value:t}})}}]),e}()}]).default});